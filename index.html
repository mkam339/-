<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>طويق التعليمية — نموذج واجهة</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --primary:#55AB77;
      --text:#111111;
      --muted:#6b7280;
    }
    body { font-family: 'Tajawal', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; color:var(--text); background:#fff; }
    .brand { color:var(--primary); font-weight:800; letter-spacing:1px; }
    .card-shadow { box-shadow: 0 6px 20px rgba(16,24,40,0.06); }
    .btn-primary { background:var(--primary); color:white; }
    .btn-primary:hover { background:#449a63; }
    .correct-badge { background:var(--primary); color:#fff; padding:3px 8px; border-radius:999px; font-size:12px; }
    /* small helpers */
    .hidden { display:none; }
  </style>
</head>
<body class="antialiased">

  <!-- NAVBAR -->
  <nav class="bg-white border-b">
    <div class="container mx-auto px-6 py-4 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <img id="logo" src="https://i.ibb.co/Cpc7k6bM/Screenshot-2025-08-10-135424.png=طويق" alt="logo" class="h-10">
        <div>
          <div class="brand text-2xl">طويق</div>
          <div class="text-sm text-gray-500">منصة طويق التعليمية</div>
        </div>
      </div>

      <div class="hidden md:flex items-center gap-6">
        <a href="https://mkam339.github.io/tawiq/#" class="text-sm text-gray-700 hover:text-black">الرئيسية</a>
        <a href="#contact" class="text-sm text-gray-700 hover:text-black">تواصل</a>
      </div>

      <div class="flex items-center gap-3">
        <button id="btnLogin" class="text-sm px-4 py-2 border rounded hover:bg-gray-50">تسجيل/دخول</button>
        <button id="btnDashboard" class="text-sm px-4 py-2 btn-primary rounded hidden">لوحة المشرف</button>
      </div>
    </div>
  </nav>

  <!-- HERO -->
  <header class="container mx-auto px-6 py-12">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
      <div>
        <h1 class="text-4xl lg:text-5xl font-extrabold leading-tight">
          طويق التعليمية — رحلة التميز تبدأ هنا
        </h1>
        <p class="mt-4 text-gray-600">دورات متخصصة، اختبارات كمي ولفظي، ومنهجية مراجعة ذكية تساعدك تتفوق.</p>

        <div class="mt-6 flex gap-3">
          <a href="#" onclick="goToMyCourses()" class="px-6 py-3 border rounded text-sm">دوراتي</a>
        </div>

        <div class="mt-8 text-sm text-gray-500">
          <span class="inline-block mr-3">: <span class="px-2 rounded" style="background:var(--primary); color:#fff">#55AB77</span></span>
         
        </div>
      </div>

      <div class="hidden lg:block">
        <img src="https://i.ibb.co/Cpc7k6bM/Screenshot-2025-08-10-135424.png=طويق+تعليمي" alt="hero" class="rounded-lg card-shadow w-full">
      </div>
    </div>
  </header>

  <!-- COURSES SECTION -->
  <section id="courses" class="container mx-auto px-6 pb-12">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-2xl font-bold">أحدث الدورات</h2>
      <div class="flex gap-2">
       <input id="searchInput" placeholder="ابحث عن دورة..." class="px-3 py-2 border rounded" />
        <button class="px-3 py-2 border rounded" onclick="renderCourses()">بحث</button>
      </div>
    </div>

    <div id="coursesContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      <!-- populated by JS -->
    </div>
  </section>

  <!-- COURSE DETAIL (modal/panel) -->
  <div id="courseDetail" class="fixed inset-0 bg-black/40 hidden items-center justify-center p-6">
    <div class="bg-white rounded-lg w-full max-w-4xl overflow-hidden shadow-xl">
      <div class="flex justify-between items-center p-4 border-b">
        <h3 id="detailTitle" class="text-xl font-bold"></h3>
        <button class="px-3 py-1 text-gray-600" onclick="closeDetail()">إغلاق ✕</button>
      </div>
      <div class="p-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="lg:col-span-1">
          <img id="detailImage" src="https://placehold.co/600x400" alt="" class="rounded-lg w-full">
          <div class="mt-4">
            <div class="text-2xl font-bold text-gray-800" id="detailPrice"></div>
            <div class="text-sm text-gray-500">مدة الدورة: <span id="detailDuration">—</span></div>
            <div class="mt-3">
              <button class="w-full py-2 btn-primary rounded" onclick="buyCourse()">اشترِ الآن</button>
            </div>
          </div>
        </div>
        <div class="lg:col-span-2">
          <h4 class="font-semibold">الوصف</h4>
          <p id="detailDesc" class="mt-2 text-gray-700"></p>

          <h4 class="font-semibold mt-6">ما ستتعلمه</h4>
          <ul id="detailWhat" class="list-disc list-inside mt-2 text-gray-700"></ul>

          <h4 class="font-semibold mt-6">اختبارات مرتبطة</h4>
          <div id="detailTests" class="mt-2 flex gap-3 flex-wrap"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- MY COURSES (hidden panel) -->
  <section id="myCourses" class="container mx-auto px-6 py-12 hidden">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-bold">دوراتي</h2>
      <div>
        <button onclick="goHome()" class="px-4 py-2 border rounded">العودة</button>
      </div>
    </div>

    <div id="myCoursesContainer" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
  </section>

  <!-- AFTER PAYMENT (Simulated external completion page with buttons editable by admin) -->
  <section id="postPayment" class="container mx-auto px-6 py-12 hidden">
    <div class="bg-white p-6 rounded-lg card-shadow">
      <div class="flex justify-between items-center">
        <h2 class="text-xl font-bold">اكتمال الدفع — ابدأ الدورة الآن</h2>
        <div>
          <button class="px-4 py-2 rounded border" onclick="goHome()">العودة</button>
        </div>
      </div>

      <p class="mt-3 text-gray-600">المحتويات التالية متاحة لك. يمكن للمشرف إضافة أو حذف الأزرار من لوحة المشرفين.</p>

      <div id="courseButtons" class="mt-6 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"></div>
    </div>
  </section>

  <!-- ADMIN PANEL (UI-only) -->
  <section id="adminPanel" class="container mx-auto px-6 py-12 hidden">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-bold">لوحة المشرف</h2>
      <div>
        <button onclick="goHome()" class="px-4 py-2 border rounded">خروج</button>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Buttons manager -->
      <div class="bg-white p-6 rounded-lg card-shadow">
        <h3 class="font-semibold mb-4">إدارة أزرار صفحة الدورة</h3>

        <div class="flex gap-2 mb-4">
          <input id="newBtnTitle" placeholder="عنوان الزر" class="px-3 py-2 border rounded w-full" />
          <input id="newBtnUrl" placeholder="رابط (URL)" class="px-3 py-2 border rounded w-full" />
        </div>
        <div class="flex gap-2">
          <button class="px-4 py-2 btn-primary rounded" onclick="addCourseButton()">إضافة زر</button>
          <button class="px-4 py-2 border rounded" onclick="clearCourseButtons()">مسح الكل</button>
        </div>

        <div id="adminButtonsList" class="mt-4 space-y-2"></div>
      </div>

      <!-- Questions manager -->
      <div class="bg-white p-6 rounded-lg card-shadow">
        <h3 class="font-semibold mb-4">إضافة أسئلة للاختبارات (واجهة)</h3>

        <input id="qTest" placeholder="اختبار/دورة (اسم)" class="px-3 py-2 border rounded w-full mb-2" />
        <textarea id="qText" placeholder="نص السؤال" class="px-3 py-2 border rounded w-full mb-2"></textarea>

        <div class="grid grid-cols-1 gap-2 mb-2">
          <input id="opt1" placeholder="خيار 1" class="px-3 py-2 border rounded w-full" />
          <input id="opt2" placeholder="خيار 2" class="px-3 py-2 border rounded w-full" />
          <input id="opt3" placeholder="خيار 3" class="px-3 py-2 border rounded w-full" />
          <input id="opt4" placeholder="خيار 4" class="px-3 py-2 border rounded w-full" />
        </div>

        <div class="flex gap-2 items-center mb-3">
          <label class="text-sm">الإجابة الصحيحة:</label>
          <select id="correctIndex" class="px-3 py-2 border rounded">
            <option value="0">خيار 1</option>
            <option value="1">خيار 2</option>
            <option value="2">خيار 3</option>
            <option value="3">خيار 4</option>
          </select>
          <label class="mr-4 text-sm">وقت (ثانية لكل سؤال, فارغ = مفتوح)</label>
          <input id="qTime" type="number" min="0" placeholder="مثلاً 30" class="px-3 py-2 border rounded w-32" />
        </div>

        <div class="flex gap-2">
          <button class="px-4 py-2 btn-primary rounded" onclick="addQuestion()">إضافة سؤال</button>
          <button class="px-4 py-2 border rounded" onclick="clearQuestions()">مسح الأسئلة</button>
        </div>

        <div id="adminQuestionsList" class="mt-4 space-y-2"></div>
      </div>
    </div>

    <!-- Sales preview -->
    <div class="mt-8 bg-white p-6 rounded-lg card-shadow">
      <h3 class="font-semibold mb-3">متابعة المبيعات (محاكاة)</h3>
      <div id="salesList" class="text-sm text-gray-600">لا توجد مبيعات بعد.</div>
    </div>

  </section>

  <!-- FOOTER -->
  <footer class="border-t mt-12">
    <div class="container mx-auto px-6 py-6 text-center text-sm text-gray-600">
      © 2025 طويق التعليمية — كل الحقوق محفوظة
    </div>
  </footer>

  <!-- LOGIN / REGISTER MODAL (updated form) -->
  <div id="authModal" class="fixed inset-0 bg-black/40 hidden items-center justify-center p-4">
    <div class="bg-white rounded-lg w-full max-w-md p-6">
      <div class="flex justify-between items-center">
        <h3 id="authTitle" class="text-lg font-semibold">تسجيل الدخول</h3>
        <button onclick="closeAuth()">✕</button>
      </div>

      <div id="authBody" class="mt-4">
        <!-- LOGIN FORM -->
        <form id="loginForm" onsubmit="event.preventDefault(); doLogin();">
          <input id="authEmail" placeholder="البريد الإلكتروني أو اسم المستخدم" class="w-full px-3 py-2 border rounded mb-2" />
          <input id="authPass" placeholder="كلمة المرور" type="password" class="w-full px-3 py-2 border rounded mb-2" />
          <div class="flex gap-2">
            <button type="submit" class="px-4 py-2 btn-primary rounded">دخول</button>
            <button type="button" class="px-4 py-2 border rounded" onclick="showRegisterForm()">إنشاء حساب</button>
          </div>
          <div class="mt-3 text-sm text-gray-600">تسجيل مبدئي باستخدام localStorage (نموذج فقط).</div>
        </form>

        <!-- REGISTER FORM (hidden initially) -->
        <form id="registerForm" class="hidden" onsubmit="event.preventDefault(); doRegister();">
          <input id="regEmail" placeholder="البريد الإلكتروني" class="w-full px-3 py-2 border rounded mb-2" required />
          <input id="regUsername" placeholder="اسم المستخدم" class="w-full px-3 py-2 border rounded mb-2" required />
          <input id="regPass" placeholder="كلمة المرور" type="password" class="w-full px-3 py-2 border rounded mb-2" required />
          <input id="regAdminCode" placeholder="رمز المشرف (إذا وُجد)" class="w-full px-3 py-2 border rounded mb-2" />
          <div class="flex gap-2">
            <button type="submit" class="px-4 py-2 btn-primary rounded">إنشاء حساب</button>
            <button type="button" class="px-4 py-2 border rounded" onclick="showLoginForm()">عودة للدخول</button>
          </div>
          <div class="mt-2 text-sm text-gray-500">إذا أدخلت رمز المشرف الصحيح سيتم منحك صلاحية مشرف.</div>
        </form>
      </div>
    </div>
  </div>

<script>
  /*********************
   * Admin code value
   *********************/
  const ADMIN_CODE = 'moshrif192837465'; // <--- رمز المشرف المطلوب

  /*********************
   * Dummy data & state
   *********************/
  const PRIMARY = '#55AB77';
  let courses = [
    { id:1, title:'دورة القياس المتقدم', price:199, image:'https://placehold.co/800x500?text=قياس', desc:'تحضير شامل لاختبار القياس مع اختبارات تجريبية.', duration:'12 ساعة', what:['أساسيات القياس','أساليب حل الأسئلة','اختبارات زمنية'], tests:[{id:'t1',title:'اختبار كمي'}] },
    { id:2, title:'دورة اللغة العربية', price:99, image:'https://placehold.co/800x500?text=عربي', desc:'تحسين المهارات اللغوية واختبارات لفظية مكثفة.', duration:'8 ساعات', what:['قواعد','قراءة','تمارين لفظي'], tests:[{id:'t2',title:'اختبار لفظي'}] },
    { id:3, title:'دورة الرياضيات المتقدمة', price:149, image:'https://placehold.co/800x500?text=رياضيات', desc:'دورة تغطي مفاهيم رياضية متقدمة مع حل مسائل.', duration:'10 ساعات', what:['جبر','هندسة','إحصاء'], tests:[] }
  ];

  let courseButtons = JSON.parse(localStorage.getItem('courseButtons') || '[]');
  let adminQuestions = JSON.parse(localStorage.getItem('adminQuestions') || '[]');
  let sales = JSON.parse(localStorage.getItem('sales') || '[]');

  /*********************
   * Utilities & routing
   *********************/
  function goHome(){ document.getElementById('courses').scrollIntoView(); showSection('home'); }
  function goToMyCourses(){ renderMyCourses(); showSection('myCourses'); }
  function showSection(s){
    document.getElementById('courses').style.display = (s==='home' ? 'block':'none');
    document.getElementById('myCourses').classList.toggle('hidden', s!=='myCourses');
    document.getElementById('postPayment').classList.toggle('hidden', s!=='postPayment');
    document.getElementById('adminPanel').classList.toggle('hidden', s!=='admin');
    if(s==='home' || s===undefined){ document.getElementById('courses').style.display='block'; document.getElementById('myCourses').classList.add('hidden'); document.getElementById('postPayment').classList.add('hidden'); document.getElementById('adminPanel').classList.add('hidden'); }
  }

  /*********************
   * Render courses
   *********************/
  function renderCourses(){
    const container = document.getElementById('coursesContainer');
    const q = (document.getElementById('searchInput').value || '').trim().toLowerCase();
    container.innerHTML = '';
    courses.filter(c => !q || c.title.toLowerCase().includes(q) || c.desc.toLowerCase().includes(q)).forEach(c=>{
      const el = document.createElement('div');
      el.className = 'bg-white rounded-lg overflow-hidden card-shadow';
      el.innerHTML = `
        <img src="${c.image}" class="w-full h-40 object-cover" />
        <div class="p-4">
          <h3 class="font-semibold text-lg">${c.title}</h3>
          <p class="text-sm text-gray-600 mt-2 line-clamp-3">${c.desc}</p>
          <div class="mt-4 flex items-center justify-between">
            <div><span class="text-xl font-bold">${c.price}</span> <span class="text-sm text-gray-500">ر.س</span></div>
            <div class="flex gap-2">
              <button class="px-3 py-1 border rounded text-sm" onclick="openDetail(${c.id})">تفاصيل</button>
              <button class="px-3 py-1 btn-primary rounded text-sm" onclick="quickBuy(${c.id})">اشتري</button>
            </div>
          </div>
        </div>`;
      container.appendChild(el);
    });
  }

  function openDetail(id){
    const c = courses.find(x=>x.id===id);
    if(!c) return;
    document.getElementById('detailTitle').innerText = c.title;
    document.getElementById('detailImage').src = c.image;
    document.getElementById('detailDesc').innerText = c.desc;
    document.getElementById('detailPrice').innerText = c.price + ' ر.س';
    document.getElementById('detailDuration').innerText = c.duration;
    const what = document.getElementById('detailWhat'); what.innerHTML = ''; c.what.forEach(i=> what.innerHTML+=`<li>${i}</li>`);
    const tests = document.getElementById('detailTests'); tests.innerHTML = ''; c.tests.forEach(t=> { let b = document.createElement('button'); b.className='px-3 py-1 border rounded text-sm'; b.innerText = t.title; tests.appendChild(b); });
    document.getElementById('courseDetail').classList.remove('hidden'); document.getElementById('courseDetail').style.display='flex';
    document.getElementById('courseDetail').dataset.courseId = id;
  }
  function closeDetail(){ document.getElementById('courseDetail').classList.add('hidden'); }

  /*********************
   * Purchase flow (simulated)
   *********************/
  function quickBuy(id){
    const sale = { id: Date.now(), courseId:id, amount: courses.find(c=>c.id===id).price, status:'paid', at: Date.now(), user: getCurrentUser() ? getCurrentUser().email : 'guest' };
    sales.push(sale); localStorage.setItem('sales', JSON.stringify(sales));
    let my = JSON.parse(localStorage.getItem('myCourses') || '[]');
    // prevent duplicates
    if(!my.find(m=>m.courseId===id)) my.push({ courseId:id, purchasedAt: Date.now()});
    localStorage.setItem('myCourses', JSON.stringify(my));
    renderCourseButtons(); renderSales();
    showSection('postPayment');
  }
  function buyCourse(){ const id = parseInt(document.getElementById('courseDetail').dataset.courseId); quickBuy(id); }

  /*********************
   * My courses
   *********************/
  function renderMyCourses(){
    const container = document.getElementById('myCoursesContainer');
    container.innerHTML = '';
    const my = JSON.parse(localStorage.getItem('myCourses') || '[]');
    if(!my.length){ container.innerHTML = '<div class="text-gray-600">لم تشترِ أي دورات بعد.</div>'; return; }
    my.forEach(entry=>{
      const c = courses.find(x=>x.id===entry.courseId);
      const el = document.createElement('div'); el.className='bg-white p-4 rounded-lg flex gap-4 items-center card-shadow';
      el.innerHTML = `<img src="${c.image}" class="w-28 h-20 object-cover rounded"><div class="flex-1"><h4 class="font-semibold">${c.title}</h4><div class="text-sm text-gray-500">تم الشراء: ${new Date(entry.purchasedAt).toLocaleString()}</div></div><div><button class="px-3 py-2 btn-primary rounded" onclick="enterCourse(${c.id})">ابدأ الدورة</button></div>`;
      container.appendChild(el);
    });
  }
  function enterCourse(courseId){ renderCourseButtons(); showSection('postPayment'); }

  /*********************
   * Course Buttons (admin managed)
   *********************/
  function renderCourseButtons(){
    const wrap = document.getElementById('courseButtons'); wrap.innerHTML = '';
    if(!courseButtons.length){ wrap.innerHTML = '<div class="text-gray-600">لا توجد أزرار مُضافة بعد — اطلب من المشرف إضافتها.</div>'; return; }
    courseButtons.forEach((b,idx)=>{
      const el = document.createElement('div'); el.className='p-4 bg-white rounded-lg flex items-center justify-between card-shadow';
      el.innerHTML = `<div><div class="font-semibold">${b.title}</div><div class="text-sm text-gray-500">${b.url}</div></div><div class="flex gap-2"><a target="_blank" href="${b.url}" class="px-3 py-2 btn-primary rounded text-sm">افتح</a></div>`;
      wrap.appendChild(el);
    });
    renderAdminButtonsList();
  }

  function addCourseButton(){
    const title = document.getElementById('newBtnTitle').value.trim();
    const url = document.getElementById('newBtnUrl').value.trim();
    if(!title || !url){ alert('أدخل عنوانًا ورابطًا'); return; }
    courseButtons.push({ title, url });
    localStorage.setItem('courseButtons', JSON.stringify(courseButtons));
    renderCourseButtons();
    document.getElementById('newBtnTitle').value=''; document.getElementById('newBtnUrl').value='';
  }
  function clearCourseButtons(){ if(!confirm('مسح جميع الأزرار؟')) return; courseButtons=[]; localStorage.setItem('courseButtons','[]'); renderCourseButtons(); }

  function renderAdminButtonsList(){
    const list = document.getElementById('adminButtonsList'); list.innerHTML='';
    courseButtons.forEach((b,i)=>{
      const row = document.createElement('div'); row.className='flex items-center justify-between gap-3';
      row.innerHTML = `<div class="text-sm">${b.title} <div class="text-xs text-gray-500">${b.url}</div></div><div class="flex gap-2"><button class="px-3 py-1 border rounded" onclick="removeButton(${i})">حذف</button></div>`;
      list.appendChild(row);
    });
  }
  function removeButton(idx){ courseButtons.splice(idx,1); localStorage.setItem('courseButtons', JSON.stringify(courseButtons)); renderCourseButtons(); }

  /*********************
   * Admin questions management
   *********************/
  function renderAdminQuestions(){
    const list = document.getElementById('adminQuestionsList'); list.innerHTML='';
    adminQuestions.forEach((q,i)=>{
      const el = document.createElement('div'); el.className='p-3 border rounded flex items-start justify-between';
      el.innerHTML = `<div><div class="font-semibold">${q.testName}</div><div class="text-sm mt-1">${q.text}</div><div class="mt-2 text-xs text-gray-500">الخيارات: ${q.options.join(' | ')}</div><div class="mt-2"><span class="correct-badge">الإجابة: خيار ${parseInt(q.correct)+1}</span> <span class="text-xs text-gray-500 ml-2">وقت: ${q.time || 'مفتوح'}</span></div></div><div><button class="px-3 py-1 border rounded" onclick="removeQuestion(${i})">حذف</button></div>`;
      list.appendChild(el);
    });
  }
  function addQuestion(){
    const testName = document.getElementById('qTest').value.trim() || 'عام';
    const text = document.getElementById('qText').value.trim(); 
    const options = [document.getElementById('opt1').value, document.getElementById('opt2').value, document.getElementById('opt3').value, document.getElementById('opt4').value].map(s=>s||'—');
    const correct = document.getElementById('correctIndex').value;
    const time = document.getElementById('qTime').value || null;
    if(!text){ alert('أدخل نص السؤال'); return; }
    adminQuestions.push({ testName, text, options, correct, time });
    localStorage.setItem('adminQuestions', JSON.stringify(adminQuestions));
    renderAdminQuestions();
    document.getElementById('qText').value=''; document.getElementById('opt1').value=''; document.getElementById('opt2').value=''; document.getElementById('opt3').value=''; document.getElementById('opt4').value='';
  }
  function clearQuestions(){ if(!confirm('مسح جميع الأسئلة؟')) return; adminQuestions=[]; localStorage.setItem('adminQuestions','[]'); renderAdminQuestions(); }
  function removeQuestion(i){ adminQuestions.splice(i,1); localStorage.setItem('adminQuestions', JSON.stringify(adminQuestions)); renderAdminQuestions(); }

  /*********************
   * Sales rendering
   *********************/
  function renderSales(){
    const el = document.getElementById('salesList');
    if(!sales.length) { el.innerText = 'لا توجد مبيعات بعد.'; return; }
    el.innerHTML = '';
    sales.slice().reverse().forEach(s=>{
      const c = courses.find(x=>x.id===s.courseId) || {title:'(دورة محذوفة)'};
      const row = document.createElement('div'); row.className='flex items-center justify-between py-2 border-b';
      row.innerHTML = `<div class="text-sm">${c.title} — ${s.user}</div><div class="text-sm text-gray-500">${new Date(s.at).toLocaleString()} — ${s.amount} ر.س</div>`;
      el.appendChild(row);
    });
  }

  /*********************
   * Auth (localStorage) with admin code check
   *********************/
  function getCurrentUser(){ return JSON.parse(localStorage.getItem('currentUser') || 'null'); }
  function setCurrentUser(u){ localStorage.setItem('currentUser', JSON.stringify(u)); updateAuthUI(); }
  function doLogin(){
    const email = document.getElementById('authEmail').value.trim();
    const pass = document.getElementById('authPass').value;
    if(!email || !pass){ alert('أكمل الحقول'); return; }
    const users = JSON.parse(localStorage.getItem('users') || '[]');
    const found = users.find(x=> (x.email===email || x.username===email) && x.pass===pass);
    if(found){
      setCurrentUser(found);
      closeAuth();
      alert('تم تسجيل الدخول كمستخدم: '+(found.username||found.email));
      if(found.role==='admin'){ showAdminPanel(); }
    } else {
      alert('بيانات غير صحيحة أو المستخدم غير مسجل');
    }
  }

  // show register form inside modal
  function showRegisterForm(){
    document.getElementById('loginForm').classList.add('hidden');
    document.getElementById('registerForm').classList.remove('hidden');
    document.getElementById('authTitle').innerText = 'إنشاء حساب';
  }
  function showLoginForm(){
    document.getElementById('loginForm').classList.remove('hidden');
    document.getElementById('registerForm').classList.add('hidden');
    document.getElementById('authTitle').innerText = 'تسجيل الدخول';
  }

  function doRegister(){
    const email = document.getElementById('regEmail').value.trim();
    const username = document.getElementById('regUsername').value.trim();
    const pass = document.getElementById('regPass').value;
    const adminCode = document.getElementById('regAdminCode').value.trim();

    if(!email || !username || !pass){ alert('أكمل الحقول'); return; }
    const users = JSON.parse(localStorage.getItem('users') || '[]');
    if(users.find(u=>u.email===email)){ alert('هذا البريد مسجل بالفعل'); return; }

    // role decision based on admin code
    let role = 'student';
    if(adminCode && adminCode === ADMIN_CODE){
      role = 'admin';
    }

    const newUser = { email, username, pass, role };
    users.push(newUser);
    localStorage.setItem('users', JSON.stringify(users));
    alert('تم إنشاء الحساب بنجاح. الدور: ' + role);
    // auto-login
    setCurrentUser(newUser);
    closeAuth();
    if(role === 'admin') showAdminPanel();
  }

  function openAuth(){ document.getElementById('authModal').classList.remove('hidden'); showLoginForm(); }
  function closeAuth(){ document.getElementById('authModal').classList.add('hidden'); }

  function updateAuthUI(){
    const cur = getCurrentUser();
    document.getElementById('btnLogin').innerText = cur ? (cur.username || cur.email) : 'تسجيل/دخول';
    document.getElementById('btnDashboard').classList.toggle('hidden', !(cur && cur.role==='admin'));
  }

  function showAdminPanel(){
    const cur = getCurrentUser();
    if(!cur || cur.role!=='admin'){ alert('مساحة المشرفين مقفلة — سجّل كمشرف لعرضها'); return; }
    showSection('admin'); document.getElementById('adminPanel').classList.remove('hidden');
    renderAdminButtonsList(); renderAdminQuestions(); renderSales();
  }

  // bindings
  document.getElementById('btnLogin').addEventListener('click', ()=> openAuth());
  document.getElementById('btnDashboard').addEventListener('click', ()=> showAdminPanel());

  // initial render
  renderCourses();
  renderCourseButtons();
  renderAdminQuestions();
  renderSales();
  updateAuthUI();

</script>
</body>
</html>



